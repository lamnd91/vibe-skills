# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands

```bash
# Build the CLI
go build -o vibe-skills ./cmd/vibe-skills

# Run tests
go test ./...

# Download dependencies
go mod tidy

# Generate registry.json from skills
./scripts/generate-registry.sh

# Run the built binary
./vibe-skills --help
./vibe-skills list
./vibe-skills install <skill-name>
./vibe-skills list --branch develop  # Use develop branch
```

## Architecture

This is a Go CLI tool that manages Claude Code skills. Skills are markdown files fetched from a remote GitHub registry and installed to `.claude/skills/` in user projects.

### Remote GitHub Registry

Skills are stored in the `skills/` directory and fetched from GitHub raw content at runtime:
```
https://raw.githubusercontent.com/cuongtl1992/vibe-skills/{ref}/skills/registry.json
https://raw.githubusercontent.com/cuongtl1992/vibe-skills/{ref}/skills/{stack}/{name}/SKILL.md
```

The registry index (`skills/registry.json`) is auto-generated by `scripts/generate-registry.sh` or the GitHub workflow on push.

### Package Structure

- **cmd/vibe-skills/main.go** - Entry point, calls `cli.Execute()`
- **internal/cli/** - Cobra commands (init, install, remove, list, search, version, self-update)
- **internal/registry/** - GitHub registry client with caching (`GitHubRegistry`, `Cache`, types)
- **internal/installer/** - Copies skills from registry to project's `.claude/skills/`
- **internal/config/** - Parses `.vibe-skills.yaml` (project) and `~/.vibe-skills/config.yaml` (global)
- **internal/updater/** - Self-update from GitHub releases
- **internal/version/** - Version info injected via ldflags

### Ref Resolution Priority

When determining which branch/tag to fetch skills from:
1. CLI flags (`--ref`, `--branch`)
2. Project config (`.vibe-skills.yaml` â†’ `registry.ref` or `registry.branch`)
3. Global config (`~/.vibe-skills/config.yaml`)
4. Default: `main`

### Data Flow

1. User runs `vibe-skills install <skill>`
2. CLI creates `GitHubRegistry` with resolved ref
3. Registry fetches `registry.json` from GitHub (cached for 1 hour in `~/.vibe-skills/cache/`)
4. `Installer` fetches skill content and writes to `.claude/skills/<skill>.md`

### Adding New Skills

1. Create `skills/<stack>/<skill-name>/SKILL.md`
2. Run `./scripts/generate-registry.sh` to update `skills/registry.json`
3. Commit both files

### Release Process

Uses GoReleaser triggered by git tags. Version info is injected via ldflags:
```bash
git tag v0.1.0
git push --tags
# GitHub Actions runs goreleaser
```
